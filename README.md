# 航空告警系统

这是一个基于机器学习的航空告警分类系统，用于自动分析和识别真实告警与虚假告警，提供预测与评估功能。系统采用XGBoost算法和BERT文本处理结合的混合方法，对航空告警数据进行智能分析和分类。

## 功能特点

- 基于XGBoost的告警分类器，支持GPU加速
- 集成学习方法提高预测稳定性和准确率
- BERT中文模型辅助的标签提取
- 多维度特征工程（分类特征、时间特征、网络特征等）
- 详细的错误分析和特征重要性评估
- 完整的模型训练和测试流程
- 模型版本管理和持久化
- 内存使用监控和优化

## 系统架构

该系统由以下主要组件构成：

- **DataPreprocessor**：数据预处理器，负责数据清洗和特征工程
  - 编码分类特征（告警类型、航班号、机场等）
  - 从告警描述中提取数值特征
  - 创建时间相关特征（小时、月份、年份）
  - 使用NetworkX创建机场网络特征（连接度、航线重要性）

- **LabelExtractor**：标签提取器，使用BERT模型从备注文本中提取标签
  - 利用中文BERT模型处理文本
  - 批处理功能提高大量样本处理效率
  - 备用关键词匹配机制确保系统稳定性

- **AlarmClassifier**：告警分类器，训练模型并提供集成预测
  - 基于XGBoost算法的分类模型
  - 交叉验证训练策略，提高泛化能力
  - 类别不平衡处理
  - 集成预测方法，多个模型预测结果取平均值

- **ModelEvaluator**：模型评估器，负责评估模型性能和错误分析
  - 基础错误统计（按告警类型、机场等分类）
  - 时间维度分析（按小时、月份、年份）
  - 虚报和漏报分析
  - 错误样本示例提取

- **ModelManager**：模型管理器，处理模型的保存、加载和版本控制
  - 基于时间戳的模型版本管理
  - 保存模型、配置、评估结果等完整信息
  - 模型版本查询和加载功能

- **AviationAlarmSystem**：系统主类，协调各组件工作，提供完整的训练和测试流程

## 运行环境要求

- Python 3.8+
- pandas
- numpy
- scikit-learn
- xgboost (支持GPU加速)
- networkx
- transformers (用于BERT模型)
- torch
- joblib
- psutil
- openpyxl
- psutil

## 安装

```bash
# 克隆代码库
git clone https://github.com/FengyichenEason/aviation-alarm-system.git
cd aviation-alarm-system

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

## 使用方法

### 准备数据

将航空告警数据保存为"航空告警.xlsx"格式，确保包含必要的字段：
- 航班号三字码
- 起飞机场
- 目的机场
- 告警类型
- 告警描述
- 告警时间
- 告警日期
- 备注（用于标签提取）

告警类型及数量按照数量从高到低如下排列：
- 重要位置（87600）
- 偏航（41027）
- 特殊机场（34216）
- 盘旋等待（12061）
- 备降（4744）
- 日出日落（2025）
- 油量偏差（1328）
- 进出极地（892）
- 低油量1（729）
- 低高度（723）
- 返航（384）
- 低油量2（212）
- 7600（1）
- 7700（1）

具体数据格式可参考如下xlsx文件截图：

![image](https://github.com/user-attachments/assets/42a27bb4-301a-4fab-92ae-ea56e7b58fd2)


### 运行系统

```bash
python main.py
```

系统将提示您选择以下模式：
1. 训练新模型
2. 加载已有模型测试

#### 训练模式

选择模式"1"后，系统将：
- 加载并预处理数据
- 使用BERT模型从备注中提取标签
- 训练XGBoost集成模型
- 评估模型性能并生成详细的错误分析
- 分析特征重要性
- 保存训练结果和模型

#### 测试模式

选择模式"2"后，系统将：
- 显示所有可用的模型版本及其创建时间和准确率
- 提示您选择一个模型版本
- 加载选定的模型
- 使用模型对数据进行预测
- 如果数据包含标签，还会评估预测结果

## 项目结构

```
aviation-alarm-system/
├── main.py                  # 主程序入口
├── preprocessing.py         # 数据预处理模块
├── label_extraction.py      # 标签提取模块
├── model.py                 # 分类器模型模块
├── evaluation.py            # 评估模块
├── model_manager.py         # 模型管理模块
├── config.py                # 配置参数模块
├── saved_models/            # 保存的模型目录
└── requirements.txt         # 依赖包列表
```

## 配置

系统配置参数在`config.py`文件中，您可以根据需要调整以下参数：

### ModelConfig
- `max_depth`：XGBoost树的最大深度（默认6）
- `learning_rate`：学习率（默认0.1）
- `n_estimators`：树的数量（默认200）
- `early_stopping_rounds`：早停轮数（默认10）
- `bert_max_length`：BERT模型最大序列长度（默认128）
- `batch_size`：批处理大小（默认32）
- `model_dir`：模型保存目录（默认'saved_models'）

### TrainingConfig
- `test_size`：测试集比例（默认0.2）
- `random_state`：随机种子（默认42）
- `n_splits`：交叉验证折数（默认5）

### FeatureConfig
- `NEEDED_COLUMNS`：必要的数据列
- `CATEGORICAL_FEATURES`：需要编码的分类特征

## 错误分析

系统提供详细的错误分析功能，包括：

- **基础错误统计**：按告警类型、机场等维度的错误分布
- **时间维度分析**：按小时、月份、年份的错误分布和趋势
- **虚报和漏报分析**：详细区分不同类型的预测错误
- **样本示例**：提供具体的错误预测样本，便于分析

错误分析报告会在训练和测试过程中自动生成，包含图表和详细的统计信息。

## 特征工程

系统实现了多种特征工程策略：

1. **分类特征编码**：对告警类型、航班号、机场等进行标签编码
2. **数值特征提取**：从告警描述文本中提取数字信息
3. **时间特征**：从告警时间和日期创建小时、月份、年份特征
4. **网络特征**：
   - `dep_degree`：起飞机场的出度（该机场飞往的不同目的地数量）
   - `arr_degree`：目的机场的入度（飞往该机场的不同起飞机场数量）
   - `route_importance`：特定航线的重要性（该航线出现的次数）

## 常见问题

**Q: 系统需要GPU吗?**  
A: 系统支持GPU加速（用于XGBoost和BERT模型），但也可在CPU模式下运行，只需修改model.py中的`tree_method`参数和label_extraction.py中的设备配置。

**Q: 如何处理没有"备注"列的数据?**  
A: 系统会检测"备注"列的存在。如果不存在，将使用默认的分类逻辑。如果测试数据有"备注"列，系统会提取真实标签并评估预测性能。

**Q: 如何改进模型性能?**  
A: 您可以尝试:
- 增加训练数据量
- 调整`config.py`中的模型参数（如深度、学习率等）
- 在`preprocessing.py`中添加更多特征工程步骤
- 尝试不同的BERT模型或微调BERT模型

**Q: 系统可以处理多语言告警数据吗?**  
A: 当前系统使用中文BERT模型，主要针对中文告警数据。如需处理其他语言，可以替换为多语言BERT模型或特定语言的预训练模型。

## 贡献指南

欢迎提交问题和改进建议。如需贡献代码，请：
1. Fork本仓库
2. 创建您的特性分支
3. 提交您的更改
4. 推送到分支
5. 创建新的Pull Request

